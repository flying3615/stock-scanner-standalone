// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model StockSnapshot {
  id                Int      @id @default(autoincrement())
  symbol            String
  date              DateTime @default(now())
  price             Float
  valueScore        Int
  sentimentScore    Float
  moneyFlowStrength Float
  
  // Relations
  signals OptionSignal[]
  combos  OptionCombo[]

  @@index([symbol, date])
}

model OptionSignal {
  id          Int           @id @default(autoincrement())
  snapshotId  Int
  type        String        // 'call' | 'put'
  strike      Float
  expiry      DateTime
  notional    Float
  direction   String        // 'buy' | 'sell'
  
  snapshot    StockSnapshot @relation(fields: [snapshotId], references: [id])
  
  @@index([snapshotId])
}

model OptionCombo {
  id          Int           @id @default(autoincrement())
  snapshotId  Int
  strategy    String        // 'Bull Call Spread', 'Straddle', etc.
  description String
  notional    Float
  riskProfile String?       // 'Bullish', 'Bearish', 'Hedge'
  
  snapshot    StockSnapshot @relation(fields: [snapshotId], references: [id])
  
  @@index([snapshotId])
}

model SectorStat {
  id           Int      @id @default(autoincrement())
  date         DateTime @default(now())
  sector       String
  
  // Metrics
  stockCount   Int      // How many stocks in Top 20 constitute this sector
  avgChange    Float    // Average % change of these stocks
  totalVolume  Float    // Aggregate volume
  
  // Momentum Indicators
  leaderSymbol String?  // Top stock in this sector
  leaderChange Float?   // Top stock % change
  
  // Context
  rank         Int      // Rank in the daily list (1st, 2nd, etc.)
  
  @@index([date, sector])
}
